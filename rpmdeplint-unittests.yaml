- job:
    name: rpmdeplint-unittests
    description: "Run all tests for rpmdeplint against HEAD"
    node: fedora
    scm:
        - git:
            url: git://git.beaker-project.org/rpmdeplint
            branches:
                - origin/master
            clean: true
            wipe-workspace: false
            skip-tag: true
            reference-repo: /var/lib/jenkins/gitreference/rpmdeplint
    triggers:
        - pollscm: "H/5 * * * *"
    builders:
        - shell: |
            set -o pipefail
            mkdir -p $(pwd)/buildroot
            python setup.py install --root=$(pwd)/buildroot
            PYTHONPATH=$(pwd)/buildroot/usr/lib/python2.7/site-packages PATH=$(pwd)/buildroot/usr/bin:$PATH \
                py.test -s -vv --full-trace --durations=10 --junit-xml=junit-unit.xml rpmdeplint 2>&1 | tee tests.out
            PYTHONPATH=$(pwd)/buildroot/usr/lib/python2.7/site-packages PATH=$(pwd)/buildroot/usr/bin:$PATH \
                py.test -s -vv --full-trace --durations=10 --junit-xml=junit-accept.xml acceptance_tests 2>&1 | tee --append tests.out
    publishers:
        - report-failures
        - archive:
            artifacts: tests.out
        - junit:
            results: junit-*.xml
