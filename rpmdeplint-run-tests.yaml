- builder:
    name: rpmdeplint-run-tests
    builders:
    - shell: |
        set -o pipefail
        mkdir -p $(pwd)/buildroot
        python2 setup.py install --root=$(pwd)/buildroot
        PYTHONPATH=$(pwd)/buildroot/usr/lib/python2.7/site-packages PATH=$(pwd)/buildroot/usr/bin:$PATH \
            py.test -s -vv --full-trace --durations=10 --junit-xml=junit-unit-py2.xml rpmdeplint 2>&1 | tee tests.out
        PYTHONPATH=$(pwd)/buildroot/usr/lib/python2.7/site-packages PATH=$(pwd)/buildroot/usr/bin:$PATH \
            py.test -s -vv --full-trace --durations=10 --junit-xml=junit-accept-py2.xml acceptance_tests 2>&1 | tee --append tests.out
        if {has_python3} ; then
            python3 setup.py install --root=$(pwd)/buildroot
            PYTHONPATH=$(pwd)/buildroot/usr/lib/python3.4/site-packages PATH=$(pwd)/buildroot/usr/bin:$PATH \
                py.test-3 -s -vv --full-trace --durations=10 --junit-xml=junit-unit-py3.xml rpmdeplint 2>&1 | tee --append tests.out
            PYTHONPATH=$(pwd)/buildroot/usr/lib/python3.4/site-packages PATH=$(pwd)/buildroot/usr/bin:$PATH \
                py.test-3 -s -vv --full-trace --durations=10 --junit-xml=junit-accept-py3.xml acceptance_tests 2>&1 | tee --append tests.out
        fi
