- job:
    name: restraint-valgrind
    description: |
        Runs Restraint unit tests in Valgrind.
    concurrent: true
    node: fedora
    scm:
        - git:
            url: git://git.beaker-project.org/restraint
            branches:
                - origin/master
            clean: true
            wipe-workspace: false
            skip-tag: true
            reference-repo: /var/lib/jenkins/gitreference/restraint
    triggers:
        - pollscm: "H/5 * * * *"
    builders:
        - restraint-fetch-tarballs
        - critical-block-start
        - shell: |
            unset http_proxy
            make -C src valgrind
        - critical-block-end
    wrappers:
        - exclusion:
            resources:
                - restraint-unittests-tcp-port-binding
    publishers:
        - report-failures
